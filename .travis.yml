# This Source Code Form is licensed MPL-2.0: http://mozilla.org/MPL/2.0
#
# http://docs.travis-ci.com/user/customizing-the-build/
# http://lint.travis-ci.org/

os: linux
dist: trusty
sudo: required
services: docker
language: c

matrix:
  fast_finish: true
  include:
    - env: DOCKERDIST=ubuntu:wily

before_install:
  - uname -a
  - cat /etc/os-release
  - pwd
  - free -tm
  - make --version
  - python --version
  - $CC --version

install:
  # Build and run tests, create packages
  - sed "s|^FROM\\b.*|FROM $DOCKERDIST|" < .Dockerfile > Dockerfile
  - docker build -t rapicorn .

script:
  # Upload packages
  - docker run -ti --rm rapicorn /bin/bash -c \
        "pwd && ls -al && rapicorn/buildtool.sh bintrayup beast-team vivid deb/rapicorn *.deb"
  - docker ps -a

after_success:
  - echo "Done, all OK!"

notifications:
  irc:
    channels:
      - "irc.gimp.org#beast"
    on_success: change # always / never / change
    on_failure: change # always / never / change
    skip_join: true
  email: false
    #recipients:
    #  - rapicorn@googlegroups.com
    #on_success: change
    #on_failure: change
